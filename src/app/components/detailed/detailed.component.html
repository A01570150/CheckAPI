<body>
  <app-navbar></app-navbar>
  <div class="sidebar">
    <app-endpoint-sidebar (outputToParent)="getOutputEndpointID($event)"></app-endpoint-sidebar>
  </div>
  <div class="apiData">
    <span>
      <h1>{{api.name}}</h1>
      <h3 id="baseURL">Base URL: {{api.baseUrl}}</h3>
    </span>
  </div>
    <div class="detailContent" *ngIf="receivedEndpoint">
      <!-- <p><a href="{{baseURL}}">Base URL: {{baseURL}}</a></p> -->
      <h2 class="nombre">{{receivedEndpoint.name}}</h2>
      <table class="info">
        <tr [ngClass]="{get2: receivedEndpoint.methodType == 'GET', post2: receivedEndpoint.methodType == 'POST', put2: receivedEndpoint.methodType == 'PUT', delete2: receivedEndpoint.methodType == 'DELETE'}">
          <th [ngClass]="{get: receivedEndpoint.methodType == 'GET', post: receivedEndpoint.methodType == 'POST', put: receivedEndpoint.methodType == 'PUT', delete: receivedEndpoint.methodType == 'DELETE'}">
            {{receivedEndpoint.methodType}}</th>
          <th id="endPath">{{receivedEndpoint.path}}</th>
          <th> Last response: {{receivedEndpoint.lastResp}}</th>
          <th>2 days ago</th>
        </tr>
      </table>
      <br>
      <p>{{receivedEndpoint.endpointDescription}}</p>
      <div *ngIf="receivedParams.length!==0">
        <p class="separador">HEADERS</p>

        <div class="container-fluid" style="padding: 1rem;">
            <div class="row">
                <div class="col-md-5">
                    <strong>Key</strong>
                </div>
                <div class="col-md-6">
                    <strong>Value</strong>
                </div>
                <div class="col-md-1"></div>
            </div>
        </div>
        <div *ngFor="let item of requestHeaders; let index=index" class="container-fluid">
            <div class="row">
                <div class="col-md-5">
                    <mat-form-field class="w-100">
                        <input
                            matInput
                            [disabled]="item.key === 'Content-Type'"
                            class="requestBodyItem"
                            [(ngModel)]="item.key"
                        >
                    </mat-form-field>
                </div>
                <div class="col-md-6">
                    <mat-form-field class="w-100">
                        <input
                            matInput
                            [disabled]="item.key === 'Content-Type'"
                            class="requestBodyItem"
                            [(ngModel)]="item.value"
                        >
                    </mat-form-field>
                </div>
                <div class="col-md-1">
                    <button
                        mat-button
                        [disabled]="item.key === 'Content-Type'"
                        color="warn"
                        class="d-block mx-auto"
                        style="outline: none;"
                        (click)="removeItem(index, 'Headers')"
                    >
                        <i class="material-icons">highlight_off</i>
                    </button>
                </div>
            </div>
        </div>
        <button
            mat-flat-button
            color="accent"
            [disabled]="isAddDisabled('Headers')"
            style="outline: none;"
            (click)="addItem('Headers')"
        >
            <span>ADD ITEM</span>
        </button>

        <p class="separador">PARAMETERS</p>
        <table class="params">
          <tr>
            <th>Name</th>
            <th>Type</th>
            <th> Description</th>
            <th></th>
          </tr>
          <br>
          <tr *ngFor="let param of receivedParams; let i = index">
            <td>{{param.paramName}}</td>
            <td>{{param.dataType}}</td>
            <td>{{param.paramDescription}}</td>
            <td>
              <form *ngIf="param.dataType == 'STRING'" [formGroup]="stringForm">
                <mat-form-field>
                <input class="searchInput" type="text"
                placeholder={{param.paramName}}
                [ngModel]="paramMap.get(param.paramName)"
                (ngModelChange)="paramMap.set(param.paramName, $event);didBindParam(param.paramName)"
                aria-label="Search" matInput formControlName="var" [errorStateMatcher]="matcher"> <!-- usar valor de aqui para concatenar en request  -->
                <mat-error *ngIf="stringFormControl.hasError('required')">
                  parameter is <strong>required</strong>
                </mat-error>
              </mat-form-field>
              </form>
              <form *ngIf="param.dataType == 'integer'" [formGroup]="integerForm">
                <mat-form-field>
                <input class="searchInput" type="text"
                placeholder={{param.paramName}}
                [ngModel]="paramMap.get(param.paramName)"
                (ngModelChange)="paramMap.set(param.paramName, $event);didBindParam(param.paramName)"
                aria-label="Search" matInput formControlName="var" [errorStateMatcher]="matcher"> <!-- usar valor de aqui para concatenar en request  -->
                <mat-error *ngIf="integerFormControl.hasError('required')">
                  parameter is <strong>required</strong>
                </mat-error>
                <mat-error *ngIf="integerFormControl.hasError">
                  parameter should be a <strong>number</strong>
                </mat-error>
              </mat-form-field>
              </form>
            </td>
          </tr>
        </table>
        <button mat-flat-button [disabled]="stringForm.invalid && integerForm.invalid" color="primary" (click)="sendRequest()">
          Test
      </button>
      </div>
      <br>
      <!-- CONSOLE LOG OUTP -->
          <!-- <div *ngFor="let queryParam of queryParams">
              {{ queryParam.input }}
          </div> -->
      <p class="separador">Responses</p>
      <table class="params">
        <tr>
          <th>Code</th>
          <th>Description</th>
          <th>Response Time: {{responseTime}}</th>
          <th></th>
        </tr>
        <br>
        <tr>
          <td>{{receivedEndpoint.number}}</td>
          <td>{{receivedEndpoint.respDescription}}</td>
          <td></td>
          <td></td>
        </tr>
      </table>
      <div class="w-100" style="background-color: black; padding: 1rem; min-height: 5rem;">
        <mat-progress-spinner
            *ngIf="loadingState"
            class="d-block mx-auto"
            color="accent"
            mode="indeterminate"
        ></mat-progress-spinner>
        <pre
            *ngIf="responseData"
            style="color: #A2C3AA; white-space: pre-wrap;"
        >{{ responseData }}</pre>
        <pre
            *ngIf="responseError"
            style="color: rgb(255, 96, 96); white-space: pre-wrap;"
        >{{ responseError }}</pre>
    </div>
    </div>
</body>
